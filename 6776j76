local main = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local up = Instance.new("TextButton")
local down = Instance.new("TextButton")
local onof = Instance.new("TextButton")
local TextLabel = Instance.new("TextLabel")
local plus = Instance.new("TextButton")
local speed = Instance.new("TextLabel")
local mine = Instance.new("TextButton")
local closebutton = Instance.new("TextButton")
local mini = Instance.new("TextButton")
local mini2 = Instance.new("TextButton")

main.Name = "main"
main.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
main.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
main.ResetOnSpawn = false

Frame.Parent = main
Frame.BackgroundColor3 = Color3.fromRGB(50,50,50)
Frame.BorderSizePixel = 0
Frame.Position = UDim2.new(0.1, 0, 0.4, 0)
Frame.Size = UDim2.new(0, 220, 0, 80)
Frame.Active = true
Frame.Draggable = true

TextLabel.Parent = Frame
TextLabel.BackgroundColor3 = Color3.fromRGB(0,0,0)
TextLabel.BackgroundTransparency = 0.3
TextLabel.Position = UDim2.new(0,0,0,0)
TextLabel.Size = UDim2.new(1,0,0,30)
TextLabel.Font = Enum.Font.GothamBold
TextLabel.Text = "FLY GUI V3"
TextLabel.TextColor3 = Color3.fromRGB(255,255,255)
TextLabel.TextScaled = true
TextLabel.TextWrapped = true

local function createButton(name, text, color, position, size)
    local btn = Instance.new("TextButton")
    btn.Name = name
    btn.Parent = Frame
    btn.Text = text
    btn.BackgroundColor3 = color
    btn.Position = position
    btn.Size = size
    btn.Font = Enum.Font.Gotham
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.TextScaled = true
    return btn
end

up = createButton("up","UP",Color3.fromRGB(0,200,0),UDim2.new(0.05,0,0.35,0),UDim2.new(0,50,0,30))
down = createButton("down","DOWN",Color3.fromRGB(200,50,50),UDim2.new(0.05,0,0.7,0),UDim2.new(0,50,0,30))
onof = createButton("onof","fly",Color3.fromRGB(0,170,255),UDim2.new(0.55,0,0.35,0),UDim2.new(0,70,0,30))
plus = createButton("plus","+",
    Color3.fromRGB(100,100,255),UDim2.new(0.35,0,0.35,0),UDim2.new(0,50,0,30))
mine = createButton("mine","-",Color3.fromRGB(255,100,100),UDim2.new(0.35,0,0.7,0),UDim2.new(0,50,0,30))

speed.Name = "speed"
speed.Parent = Frame
speed.BackgroundColor3 = Color3.fromRGB(30,30,30)
speed.Position = UDim2.new(0.55,0,0.7,0)
speed.Size = UDim2.new(0,70,0,30)
speed.Font = Enum.Font.GothamBold
speed.TextColor3 = Color3.fromRGB(255,255,255)
speed.Text = "1"
speed.TextScaled = true
speed.TextWrapped = true

closebutton = createButton("Close","X",Color3.fromRGB(255,50,50),UDim2.new(1,-35,0,0),UDim2.new(0,30,0,30))
mini = createButton("minimize","-",Color3.fromRGB(150,150,150),UDim2.new(1,-70,0,0),UDim2.new(0,30,0,30))
mini2 = createButton("minimize2","+",
    Color3.fromRGB(100,200,100),UDim2.new(1,-70,0,0),UDim2.new(0,30,0,30))
mini2.Visible = false

local speeds = 1
local nowe = false
local tpwalking = false

local player = game.Players.LocalPlayer

local function getCharacter()
    local char = player.Character or player.CharacterAdded:Wait()
    local hum = char:FindFirstChildWhichIsA("Humanoid") or char:WaitForChild("Humanoid")
    local root = char:FindFirstChild("HumanoidRootPart") or char:WaitForChild("HumanoidRootPart")
    return char, hum, root
end

local function startFly()
    local char, hum, root = getCharacter()
    nowe = true
    hum.PlatformStand = true
    local torso = char:FindFirstChild("Torso") or char:FindFirstChild("UpperTorso")
    if not torso then return end

    local bg = Instance.new("BodyGyro", torso)
    bg.P = 9e4
    bg.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
    bg.CFrame = torso.CFrame

    local bv = Instance.new("BodyVelocity", torso)
    bv.MaxForce = Vector3.new(9e9,9e9,9e9)
    bv.Velocity = Vector3.new(0,0,0)

    local ctrl = {f=0,b=0,l=0,r=0}
    local lastctrl = {f=0,b=0,l=0,r=0}
    local speedValue = speeds

    local function updateControls()
        ctrl = {f=0,b=0,l=0,r=0}
        local uis = game:GetService("UserInputService")
        if uis:IsKeyDown(Enum.KeyCode.W) then ctrl.f = 1 end
        if uis:IsKeyDown(Enum.KeyCode.S) then ctrl.b = -1 end
        if uis:IsKeyDown(Enum.KeyCode.A) then ctrl.l = -1 end
        if uis:IsKeyDown(Enum.KeyCode.D) then ctrl.r = 1 end
    end

    spawn(function()
        while nowe and hum.Health > 0 do
            game:GetService("RunService").RenderStepped:Wait()
            updateControls()
            local moveVec = (workspace.CurrentCamera.CFrame.LookVector * (ctrl.f+ctrl.b) +
                workspace.CurrentCamera.CFrame.RightVector * (ctrl.r+ctrl.l)) * speedValue
            bv.Velocity = moveVec
            bg.CFrame = workspace.CurrentCamera.CFrame
        end
        bg:Destroy()
        bv:Destroy()
        hum.PlatformStand = false
    end)
end

local function stopFly()
    local _, hum = getCharacter()
    nowe = false
    hum.PlatformStand = false
end

onof.MouseButton1Down:Connect(function()
    if nowe then
        stopFly()
    else
        startFly()
    end
end)

plus.MouseButton1Down:Connect(function()
    speeds = speeds + 1
    speed.Text = speeds
end)

mine.MouseButton1Down:Connect(function()
    if speeds > 1 then
        speeds = speeds - 1
        speed.Text = speeds
    end
end)

closebutton.MouseButton1Click:Connect(function()
    main:Destroy()
end)

mini.MouseButton1Click:Connect(function()
    up.Visible = false
    down.Visible = false
    onof.Visible = false
    plus.Visible = false
    speed.Visible = false
    mine.Visible = false
    mini.Visible = false
    mini2.Visible = true
    Frame.BackgroundTransparency = 1
    closebutton.Position = UDim2.new(0,0,-1,57)
end)

mini2.MouseButton1Click:Connect(function()
    up.Visible = true
    down.Visible = true
    onof.Visible = true
    plus.Visible = true
    speed.Visible = true
    mine.Visible = true
    mini.Visible = true
    mini2.Visible = false
    Frame.BackgroundTransparency = 0
    closebutton.Position = UDim2.new(0,0,-1,27)
end)
